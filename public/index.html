<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>IMPOSTOR v2.0</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>

  <div id="ejectionOverlay" class="screen" style="display: none; background: rgba(0,0,0,0.95); z-index: 200; align-items: center; justify-content: center;">
      <div class="panel-box" style="max-width: 400px; text-align: center;">
          <h1 id="resultTitle" style="font-size: 3rem; margin-bottom: 10px;">---</h1>
          <p id="resultSubtitle" style="color: #888; margin-bottom: 30px;">---</p>
          <div id="finalDetailsBox" style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
              <p style="font-size: 0.8rem; color: #666;">PALABRA CLAVE</p>
              <h3 id="resultWord" style="color: var(--primary); font-size: 1.5rem;">---</h3>
              <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">IMPOSTORES</p>
              <h3 id="resultImpostorName" style="color: var(--accent-red); font-size: 1.2rem;">---</h3>
          </div>
          <button id="btnBackToLobby" class="btn-action btn-primary">CONTINUAR</button>
      </div>
  </div>

  <div id="screenHome" class="screen" style="align-items: center; justify-content: center;">
      <div style="text-align: center; margin-bottom: 40px;">
          <h1 style="font-size: 3rem; font-weight: 900; letter-spacing: -2px;">INCOGNITO<span style="color:var(--primary)">.SYS</span></h1>
          <p style="color: #666; letter-spacing: 2px;">PROTOCOLO DE INFILTRACI√ìN</p>
      </div>
      <div style="width: 100%; max-width: 300px; display: flex; flex-direction: column; gap: 15px;">
          <button id="btnGoCreate" class="btn-action btn-primary">CREAR SALA</button>
          <button id="btnGoJoin" class="btn-action" style="background:transparent; border:1px solid #444; color:white;">UNIRSE A SALA</button>
      </div>
  </div>

  <div id="screenCreate" class="screen" style="display: none;">
      <div class="lobby-container">
          <div class="brand-header">
              <div class="logo-text">INCOGNITO<span>.SYS</span></div>
              <button id="backFromCreate" style="background:none; border:none; color:#666; cursor:pointer;">SALIR ‚úï</button>
          </div>

          <div class="lobby-grid">
              <div class="panel-box">
                  <div class="panel-title">‚öôÔ∏è CONFIGURACI√ìN DE MISI√ìN</div>
                  
                  <div style="margin-bottom: 20px;">
                      <label style="font-size: 0.7rem; color: #888; font-weight: bold;">TU ALIAS</label>
                      <input type="text" id="hostName" class="input-tech" placeholder="Ej: Agente 007" maxlength="12">
                  </div>

                  <div class="config-row"><span class="config-label">Jugadores</span><div class="counter-ui"><button class="btn-mini" onclick="adjustValue('maxPlayers', -1)">-</button><span class="val-display" id="displayPlayers">10</span><button class="btn-mini" onclick="adjustValue('maxPlayers', 1)">+</button></div><input type="hidden" id="maxPlayers" value="10"></div>
                  <div class="config-row"><span class="config-label">Impostores</span><div class="counter-ui"><button class="btn-mini" onclick="adjustValue('impostors', -1)">-</button><span class="val-display" id="displayImpostors">2</span><button class="btn-mini" onclick="adjustValue('impostors', 1)">+</button></div><input type="hidden" id="impostors" value="2"></div>
                  <div class="config-row"><span class="config-label">Votaci√≥n (s)</span><div class="counter-ui"><button class="btn-mini" onclick="adjustValue('timeVote', -10)">-</button><span class="val-display" id="displayVote">120</span><button class="btn-mini" onclick="adjustValue('timeVote', 10)">+</button></div><input type="hidden" id="timeVote" value="120"></div>

                  <button id="btnGoCategories" class="btn-action" style="background: rgba(255,255,255,0.1); font-size: 0.8rem; margin-bottom: 20px;">üìÇ CATEGOR√çAS (<span id="catCountDisplay">5</span>)</button>

                  <div class="rules-mini">
                      <div class="panel-title" style="margin-bottom: 10px; font-size: 0.7rem;">‚ö†Ô∏è PROTOCOLO DE JUEGO</div>
                      <p>1. <strong>Identidad:</strong> Todos reciben una palabra clave, menos el Impostor.</p>
                      <p>2. <strong>Interrogatorio:</strong> Por turnos, digan una palabra relacionada.</p>
                      <p>3. <strong>Ejecuci√≥n:</strong> Si eres Ciudadano, descubre al intruso. Si eres Impostor, finge y sobrevive.</p>
                  </div>

                  <button id="btnCreateRoom" class="btn-action btn-primary" style="margin-top: 20px;">INICIAR SISTEMA</button>
              </div>

              </div>
      </div>
  </div>

  <div id="screenJoin" class="screen" style="display: none; align-items: center; justify-content: center;">
      <div class="panel-box" style="width: 100%; max-width: 400px;">
          <button id="backFromJoin" style="position: absolute; top: 15px; right: 15px; background:none; border:none; color:#666;">‚úï</button>
          <div class="panel-title">ACCESO REMOTO</div>
          <div style="margin-bottom: 20px;">
              <label style="font-size: 0.7rem; color: #888;">TU ALIAS</label>
              <input type="text" id="joinName" class="input-tech" placeholder="Nombre...">
          </div>
          <div style="margin-bottom: 30px;">
              <label style="font-size: 0.7rem; color: #888;">C√ìDIGO DE SALA</label>
              <input type="text" id="joinCode" class="input-tech" placeholder="ABCD">
          </div>
          <button id="btnJoinRoom" class="btn-action btn-primary">CONECTAR</button>
      </div>
  </div>

  <div id="screenCategories" class="screen" style="display: none;">
      <div class="lobby-container">
          <div class="brand-header"><div class="logo-text">DATA<span>BASE</span></div><button id="backFromCategories" style="background:none; border:none; color:white;">VOLVER</button></div>
          <div id="categoriesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 20px;"></div>
          <button id="btnConfirmCategories" class="btn-action btn-primary" style="margin-top: auto;">GUARDAR SELECCI√ìN</button>
      </div>
  </div>

  <main id="mainContent" class="screen" style="display: none; padding: 0;">
      <div class="game-header">
          <div class="room-code-pill" id="btnCopyCode">SALA: <span id="roomCodeDisplay">----</span> ‚ùê</div>
          <div style="display: flex; gap: 10px;">
              <button id="btnDiscordManual" class="discord-btn" title="Abrir Discord"><img src="https://assets-global.website-files.com/6257adef93867e56f84d3092/636e0a6a49cf127bf92de1e2_icon_clyde_blurple_RGB.png" width="25" alt="D"></button>
              <button id="btnExit" class="discord-btn" style="background: #333;" title="Salir">‚úï</button>
          </div>
      </div>

      <div class="lobby-container" style="padding: 80px 20px 20px 20px;"> <div class="lobby-grid">
              
              <div class="panel-box" style="justify-content: center; align-items: center; min-height: 400px;">
                  
                  <div id="viewLobbyWait" style="text-align: center; width: 100%;">
                      <div class="panel-title" style="justify-content: center;">ESTADO DEL SISTEMA</div>
                      <h2 style="color: #666; margin: 20px 0;">ESPERANDO AGENTES...</h2>
                      <div class="rules-mini" style="text-align: left; max-width: 350px; margin: 0 auto;">
                          <p>Comparte el c√≥digo de sala o el enlace de Discord. Necesitas m√≠nimo 3 agentes para iniciar.</p>
                      </div>
                      <button id="btnStartRound" class="btn-action btn-primary" style="margin-top: 30px;" disabled>INICIAR MISI√ìN</button>
                  </div>

                  <div id="viewCard" style="display: none;">
                      <div id="secretCardContainer" class="scanner-container">
                          <div class="scanner-card">
                              <div class="front-face">
                                  <div class="fingerprint"><div class="scan-line"></div></div>
                                  <div class="lock-text">ESCANEAR IDENTIDAD</div>
                                  <div style="font-size: 0.7rem; color: #555; margin-top: 5px;">TOCA PARA REVELAR</div>
                              </div>
                              <div class="back-face" id="cardBackContent">
                                  <div class="role-reveal-box">
                                      <div style="font-size: 0.8rem; color: #888; font-weight: bold;">TU IDENTIDAD ES</div>
                                      <div class="role-title" id="roleTitleDisplay">AGENTE</div>
                                      <div id="wordContainer">
                                          <div style="font-size: 0.8rem; color: #888;">CLAVE DE ACCESO</div>
                                          <div class="secret-word" id="wordDisplay">---</div>
                                      </div>
                                      <div id="teammateBox" style="display:none; margin-top: 20px; font-size: 0.8rem; color: var(--accent-red);">
                                          ALIADOS: <b id="teammateNames"></b>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <p style="text-align: center; color: #666; font-size: 0.8rem; margin-top: 20px;">Toca de nuevo para ocultar</p>
                  </div>

                  <div id="viewTurn" style="display: none; text-align: center; width: 100%;">
                      <div class="p-avatar" style="width: 100px; height: 100px; font-size: 2rem; margin: 0 auto 20px auto; border: 4px solid var(--primary); background: transparent; color: white;" id="turnAvatar">A</div>
                      <h2 id="turnPlayerName" style="font-size: 2rem; margin-bottom: 10px;">AGENTE X</h2>
                      <div style="color: var(--primary); font-family: monospace; font-size: 1.2rem; margin-bottom: 30px;">TRANSMITIENDO... <span id="turnTimerDisplay">15</span>s</div>
                      <button id="btnFinishTurn" class="btn-action btn-primary" style="display:none;">HE TERMINADO</button>
                  </div>

                  <div id="viewVoting" style="display: none; width: 100%;">
                      <div class="panel-title" style="color: var(--accent-red); justify-content: center;">ALERTA DE SEGURIDAD</div>
                      <h2 style="text-align: center; margin-bottom: 10px;">¬øQUI√âN ES EL INTRUSO?</h2>
                      <div style="text-align: center; color: #666; margin-bottom: 20px;">Tiempo restante: <span id="votingTimer" style="color:white; font-weight: bold;">00:00</span></div>
                      
                      <div class="voting-grid" id="votingGrid"></div>
                      
                      <button id="btnSkipVote" class="btn-action" style="border: 1px solid #444; background: transparent; color: #aaa; margin-top: 20px;">SALTAR VOTO</button>
                  </div>

              </div>

              <div class="panel-box">
                  <div class="panel-title">AGENTES EN L√çNEA (<span id="playersCountHtml">0</span>)</div>
                  <div id="playersList" class="player-list-grid"></div>
              </div>
          </div>
      </div>
  </main>

  <script src="/socket.io/socket.io.js"></script>
  <script src="game.js"></script>
</body>
</html>